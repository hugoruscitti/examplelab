<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>La renovación de pilas-engine :: Examplelab — Mi blog</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Estamos muy cerca de lanzar la versión 0.91 de pilas-engine, así que me pareció buena idea compartir en el blog las características más importantes de esta nueva versión y contarte el por qué de estos cambios.
Esta es una versión muy especial, principalmente porque añadimos muchos cambios en la estructura completa del motor.
Por supuesto no hice estos cambios solo. Irving, Quique Porta, Fernando Salamero, Walter Velazquez y el equipo de HuayraLinux hicieron posible esta nueva versión."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://www.examplelab.com.ar/posts/2015-01-21-la-renovacion-de-pilas-engine/" />




<script src="https://www.examplelab.com.ar/js/menu.js"></script>
<script src="https://www.examplelab.com.ar/js/prism.js"></script>
<script src="https://www.examplelab.com.ar/js/theme.js"></script>
<script src="https://www.examplelab.com.ar/js/imagenes.js"></script>


<link rel="stylesheet" href="https://www.examplelab.com.ar/assets/style.css">

<link rel="stylesheet" href="https://www.examplelab.com.ar/css/estilo.css">
<link rel="stylesheet" href="https://www.examplelab.com.ar/css/tachyons.min.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.examplelab.com.ar/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="https://www.examplelab.com.ar/favicon-16x16.png?1">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="La renovación de pilas-engine"/>
<meta name="twitter:description" content="Estamos muy cerca de lanzar la versión ``0.91`` de *pilas-engine*, así que me pareció buena idea compartir en el blog las características más importantes de esta nueva versión..."/>



<meta property="og:title" content="La renovación de pilas-engine" />
<meta property="og:description" content="Estamos muy cerca de lanzar la versión ``0.91`` de *pilas-engine*, así que me pareció buena idea compartir en el blog las características más importantes de esta nueva versión..." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.examplelab.com.ar/posts/2015-01-21-la-renovacion-de-pilas-engine/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-01-21T02:26:10+00:00" />
<meta property="article:modified_time" content="2015-01-21T02:26:10+00:00" /><meta property="og:site_name" content="Examplelab" />







  </head>
  <body class="">
    <script>
      procesar_theme();
    </script>

    <div class="container">
      <header class="header">
  <span class="header__inner measure-2">
    <a href="/" class="logo" style="text-decoration: none;">
  <img width="64" height="64" src="/logo.png" alt="Logo" />
  <span class="logo__text pl2"> examplelab</span>
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about/index.html">Acerca de</a></li>
        
      
        
          <li><a href="/posts/index.html">Artículos</a></li>
        
      
        
          <li><a href="/links/index.html">Links</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about/index.html">Acerca de</a></li>
      
    
      
        <li><a href="/posts/index.html">Artículos</a></li>
      
    
      
        <li><a href="/links/index.html">Links</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger hidden">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        

  <div id="preview" role="button" class="dn no-user-select pointer overflow-auto vh-100 vw-100 bg-black-50 fixed z-max absolute--fill items-center justify-center">
    <div id="preview-content">
      <img src="/images/2021/la-culpa-no-es-del-dom/diff.png">
    </div>
  </div>


  <div class="post">
    <h2 class="post-title"><a href="https://www.examplelab.com.ar/posts/2015-01-21-la-renovacion-de-pilas-engine/">La renovación de pilas-engine</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
            21/01/2015
        </span>
      
      
      
    </div>

    

    <div class="post-content">
      <p>Estamos muy cerca de lanzar la versión <code>0.91</code> de <em>pilas-engine</em>, así que me pareció buena idea compartir en el blog las características más importantes de esta nueva versión y contarte el por qué de estos cambios.</p>
<p>Esta es una versión muy especial, principalmente porque añadimos muchos cambios en la estructura completa del motor.</p>
<p>Por supuesto no hice estos cambios solo. Irving, Quique Porta, Fernando Salamero, Walter Velazquez y el equipo de HuayraLinux hicieron posible esta nueva versión.</p>
<h2 id="por-qué-refactorizar">¿Por qué refactorizar?</h2>
<p>En las primeras versiones del motor, <a href="http://www.pilas-engine.com.ar">pilas-engine</a> no era una herramienta que incluía manual, interfaz gráfica o intérprete. <a href="http://www.pilas-engine.com.ar">pilas-engine</a> era sólo un módulo de python que podía ser utilizado desde la consola estándar de python.</p>
<p>Por ese motivo, algunas cosas eran globales y estaban pensadas para tener un solo punto de salida: el cierre del proceso (mediante &ldquo;sys.exit&rdquo;)</p>
<p><img src="/images/2015/01/image04.jpg" alt=""></p>
<p>Pero cuando el proyecto comenzó a crecer, nos dimos cuenta que a muchos chicos no les resultaba muy atractivo el intérprete estándar de python, y con mucha razón: el intérprete de python no tiene colores, no cuenta con autocompletado, los errores están en inglés etc &hellip;</p>
<p>Así que poco a poco fuimos implementando nuestro propio intérprete python, una ventana que sirva de punto inicial y muchas cosas más. Por eso, al seguir en esa dirección, pilas comenzó a convertirse en un entorno de desarrollo, incorporando un manual, ejemplos, modos para realizar depuraciones y todo eso buscando una experiencia uniforme para los sistemas Linux, Mac y Windows.</p>
<p><img src="/images/2015/01/image01.png" alt=""></p>
<p>Pero en este punto, se hacía muy difícil construir arriba de la arquitectura inicial, necesitábamos abordar un enfoque diferente: usando componentes que pudieramos poner a prueba con tests y reduciendo los <em>hacks</em> al mínimo&hellip;</p>
<p>Incluso hace unos años, cuando armé el proyecto <em>patín</em> tuve problemas similares al querer re-iniciar pilas&hellip;</p>
<p><img src="/images/2015/01/image09.png" alt=""></p>
<h2 id="ahora-pensando-en-integrarse">Ahora, pensando en integrarse</h2>
<p>A diferencia de la primer arquitectura, donde muchas variables eran globales al módulo, en esta nueva versión buscamos representar a <strong>pilas</strong> como un objeto, y no como un módulo.</p>
<p>La idea de “hablar” con <strong>pilas</strong> como un objeto es poder <em>iniciar</em>, <em>pausar</em>, <em>reiniciar</em> o descartar el contexto de <strong>pilas</strong> tantas veces como sea necesario. Además nos permitirá integrarlo con mayor facilidad a otras interfaces.</p>
<p>Este es un ejemplo en donde se inicializa pilas como un componente para una interfaz:</p>
<pre><code>import pilasengine

pilas = pilasengine.iniciar()
widget = pilas.obtener_widget()
</code></pre>
<p>En este punto, podríamos usar el objeto “widget” dentro del intérprete:</p>
<p><img src="/images/2015/01/image07.png" alt=""></p>
<p>Esta facilidad de integración también simplifica un poco la tarea de empaquetado para otras plataformas, gnu/linux no dá muchos problemas, pero en Mac osx y Windows aparecen varios problemas: la forma en la que inicializamos el intérprete producía errores difíciles de capturar, teníamos que lidiar con manejo de múltiples instancias en memoria de pilas y procesos para sortear este problema de diseño.</p>
<h2 id="un-solo-motor-pyqt">Un solo motor: pyqt</h2>
<p>Una de las cosas que había planificado inicialmente en pilas es soportar varias bibliotecas por debajo; o &ldquo;engines&rdquo; como se les suele decir.</p>
<p>Pilas utilizaba SFML, pyqt y en algún momento soportó pyglet, según el programador seleccione. Era una forma de proveer mayor soporte a distintos equipos y hacer de <strong>pilas</strong> una especie de “capa” que unifica el uso de multimedia para videojuegos, como una plataforma de abstracción y simplificación.</p>
<p>Lo cierto es que luego de varias versiones comenzó a notarse el costo de mantener varios motores&hellip; y después de todo, fuimos notando que pyqt podía resolver muy bien todas las necesidades que teníamos en mente. No tenía mucho sentido invertir tiempo en mantener otros motores&hellip;</p>
<p>Sin embargo, como nos focalizamos en pyqt y nunca decidimos abandonar el resto de los motores oficialmente, la arquitectura de pilas quedó con mucho código pensado para soportar otros motores. Llegamos al punto en donde el diseño es algo más complejo de lo que necesitamos, así que me pareció buena idea aprovechar la posibilidad para simplificarlo.</p>
<p>Al simplificarlo, ahora pilas ya no tiene un atributo &ldquo;motor&rdquo;, el código de manejo de imágenes, sonidos y eventos quedó mucho más simple, todo usando pyqt y pygame solamente para audios (solo porque phonon, el plugin para gestionar sonidos en qt, no funciona en varios casos).</p>
<p>Este es un ejemplo de esa inicialización en la nueva clase Pilas.Observa que ahora solo tenemos un punto de selección para el motor, puede tener aceleración gráfica o no:</p>
<p><img src="/images/2015/01/image00.png" alt=""></p>
<p>Esto es algo bastante contundente si tenías en mente el modo de funcionamiento de pilas hace unos años, ahora es mucho mas simple y hasta dan ganas de añadirle cosas :)</p>
<h2 id="notificaciones">Notificaciones</h2>
<p>Ahora el motor utiliza archivos de <strong>log</strong> como las aplicaciones web tradicionales, podrías ver el funcionamiento completo del motor mirando el archivo de log que produce pilas y emitiendo tus propios mensajes.</p>
<p>Para inicializar el reporte de errores tenemos que inicializar pilas con el flag “habilitar_mensajes_log”:</p>
<pre><code>import pilasengine

pilas = pilasengine.iniciar(habilitar_mensajes_log=True)
</code></pre>
<p>Y por un terminal tendríamos que ver cada uno de los mensajes que nos permiter ver &ldquo;qué&rdquo; está haciendo pilas en cada momento.</p>
<p>Este <em>flag</em> también se puede cambiar en cualquier momento, llamando a:</p>
<pre><code>pilas.habilitar_mensajes_log(False)
</code></pre>
<p>o bien:</p>
<pre><code>pilas.habilitar_mensajes_log(False)
</code></pre>
<p>Pienso que esta funcionalidad puede ser útil para conocer “qué” hace pilas internamente en cada momento, e incluso nos permitiría a futuro hacer distintos tipos de log. Ahora solo existe este tipo de “log” en consola, pero podríamos hacer uno que guarde un archivo en disco, o que imprima en una ventana de pyqt, algo similar a lo que hace el navegador web cuando encuentra errores:</p>
<p><img src="/images/2015/01/image08.png" alt=""></p>
<h2 id="manejo-de-errores">Manejo de errores</h2>
<p>Otro punto a mejorar en las versiones anteriores de <em>pilas</em> era el manejo de errores. Porque inicialmente nunca habíamos pensando exactamente el flujo de errores y notificaciones para el programador. Cuando pilas fallaba, la aplicación entera podía quedar &ldquo;congelada&rdquo; o cerrarse de forma abrupta&hellip;</p>
<p>Ahora, cada vez que hay un error, <strong>pilas</strong> detiene su bucle principal y pone un cartel con el motivo del error.</p>
<p><img src="/images/2015/01/image10.png" alt=""></p>
<p>Esto ayuda a eliminar por completo los efectos colaterales que teníamos con respecto a los errores dentro del bucle de pilas, esos errores que ocurrían y se imprimían una y otra vez en la consola o volvían inestable todo el proceso.</p>
<p>Al mismo tiempo hace completamente compatible la experiencia de tener un error en distintos sistemas operativos. Hasta ahora, cuando teníamos un error, había que mirar la consola si estábamos en GNU/Linux, ver el diálogo modal en Windows o atender los mensajes de sistema si estábamos en OSX …</p>
<p><img src="/images/2015/01/image02.png" alt=""></p>
<p>Este nuevo sistema de notificación de errores está implementado como una escena nueva, que se puede encontrar en el archivo <code>pilasengine/escenas/error.py</code>. Básicamente es una escena con el fondo Plano y dos actores de texto que muestran la excepción. Tal vez en el futuro pongamos algo mas de divertido para anunciar el error: <a href="http://www.intertech.com/Blog/funny-computer-error-messages/">http://www.intertech.com/Blog/funny-computer-error-messages/</a> (en busca de inspiración…)</p>
<h2 id="livereload-y-prototipado">Livereload y prototipado</h2>
<p>Con estos cambios es más sencillo y limpio reiniciar <strong>pilas</strong>, así que podemos implementar livereload y acelerar el prototipado de juegos. Por ejemplo, en el siguiente video estoy editando un script sencillo, cada vez que guardo el archivo pilas lo reconoce y lo vuelve a ejecutar completo:</p>
<iframe width="960" height="720" src="//www.youtube.com/embed/BrLq25JsYk8?rel=0" frameborder="0" allowfullscreen></iframe>
<h2 id="inicializadores-de-actores-y-escenas">Inicializadores de actores y escenas</h2>
<p>Algo característico de pilas, es que construir actores y escenas es muy simple, podemos escribir:</p>
<pre><code>pilas.actores.Aceituna()
</code></pre>
<p>y el actor aparece inmediatamente en pantalla. En muchas otras bibliotecas de juegos necesitamos guardar una referencia al objeto y luego “agregarlo” a una lista de sprites a dibujar o árbol de nodos.</p>
<p>Para hacer que esta característica se conserve, necesitamos poder vincular el actor creado con el objeto pilas automáticamente. La forma que descubrí para hacer esto me parece bastante útil, aunque es un poco rara…</p>
<p>Cuando el programador escribe “pilas.actores.Aceituna()” en lugar de estar invocando directamente a la clase Actor, ahora “Actor()” podría ser un método:</p>
<p><img src="/images/2015/01/image06.png" alt=""></p>
<p>De esta forma, al crear un actor podemos invocar a su constructor internamente y producir la vinculación.</p>
<p>Otra cosa útil de este enfoque, es que podemos simplificar la creación de nuevos actores. No va a ser necesario re-definir los constructores. Podemos decirle a cualquier chico “para implementar un actor, construí una clase con estos dos métodos”, no hace falta _ <em>init</em> _ :</p>
<pre><code>from pilasengine import Actor

class NuevActor(Actor):

	def iniciar(self):
        […]

	def actualizar(self):
        […]
</code></pre>
<p>Esta idea también podríamos llevarla a pilasweb, para que crear actores no necesite anteponer “new” y las sintaxis sean lo más parecidas posibles.</p>
<h2 id="testing">Testing</h2>
<p>Aprovechando la refactorización, comencé a pulir algunos tests y terminé haciendo una batería de tests más robusta y completa.</p>
<p>Ejecutando “make” podemos ver el comando disponible para ejecutar los test y otras cosas:</p>
<p><img src="/images/2015/01/image05.png" alt=""></p>
<p>Ahora cuando cambiamos el código de pilas, tenemos la posibilidad de corroborar que la mayor parte de la biblioteca continúa funcionando correctamente.</p>
<p>Mi intensión es hacer que estos tests funcionen bien sobre “travis-ci.org”, así podemos tener tests automáticos cada vez que hacemos “push” sobre github, de la misma forma que ocurre con pilasweb.</p>
<p>Este es un ejemplo de travis ejecutando tests de un cambio que introdujo irving:</p>
<p><img src="/images/2015/01/image03.png" alt=""></p>
<h2 id="otras-ideas-para-pensar">Otras ideas para pensar…</h2>
<p>¿Podremos implementar estas mejoras y hacerlas retro-compatibles?, ¿qué otras cosas podríamos mejorar?, ¿Nos ayudaría a unificar la interfaz entre pilas y pilas-web?.</p>
<h2 id="referencias">Referencias</h2>
<p>Mientras escribía este documento, hice algunas pruebas y bocetos sobre el siguiente repositorio, si todo sale bien, se volverá el código principal de la próxima versión de pilas-engine:</p>
<p><a href="https://github.com/hugoruscitti/python-pilas-experimental">https://github.com/hugoruscitti/python-pilas-experimental</a></p>
<p>Puede ser útil para consultar dudas o ver el progreso de estas ideas. Hay varias cosas implementadas, pero va avanzando&hellip;</p>
<p>PD: Ningún método, módulo o actor de pilas fue dañado mientras se escribió este documento.</p>

    </div>

    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h">Leer otros artículos</span>
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="https://www.examplelab.com.ar/posts/2015-02-09-llega-huayra-mu/">
                  <span class="button__icon">←</span>
                  <span class="button__text">¡ huayra-mu !</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="https://www.examplelab.com.ar/posts/2015-01-06-escalando-imagenes-con-node-webkit/">
                  <span class="button__text">Escalando imágenes con node-webkit</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    


    
      
        

      
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  <img width="64" height="64" src="/logo.png" alt="Logo" />
  <span class="logo__text pl2"> examplelab</span>
</a>

      <div class="copyright">
        <span>© 2010-2022 Hugo Ruscitti</span>
      </div>
    
  </div>
</footer>


<script src="https://www.examplelab.com.ar/assets/prism.js"></script>


      
    </div>
  </body>
</html>
