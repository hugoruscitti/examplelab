<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>Cocos y pyglet en modo interactivo :: Examplelab — Mi blog</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Python tiene una herramienta super interesante para los nuevos programadores: una consola interactiva donde se puede editar, corregir y ejecutar código de manera super sencilla.
Esto resulta de mucha utilidad cuando quieres dar clases sobre programación o simplemente dar una demostración sobre alguna biblioteca.
Introducción Lamentablemente la consola de python no se puede usar en cualquier escenario, por ejemplo si quieres dar una demostración de la biblioteca cocos2d desde la consola interactiva se te pueden presentar algunos problemas."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://www.examplelab.com.ar/posts/2010-06-30-cocos-y-pyglet-en-modo-interactivo/" />




<script src="https://www.examplelab.com.ar/js/menu.js"></script>
<script src="https://www.examplelab.com.ar/js/prism.js"></script>
<script src="https://www.examplelab.com.ar/js/theme.js"></script>
<script src="https://www.examplelab.com.ar/js/imagenes.js"></script>


<link rel="stylesheet" href="https://www.examplelab.com.ar/assets/style.css">

<link rel="stylesheet" href="https://www.examplelab.com.ar/css/estilo.css">
<link rel="stylesheet" href="https://www.examplelab.com.ar/css/tachyons.min.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.examplelab.com.ar/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="https://www.examplelab.com.ar/favicon-16x16.png?1">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Cocos y pyglet en modo interactivo"/>
<meta name="twitter:description" content="Python tiene una herramienta super interesante para los nuevos programadores..."/>



<meta property="og:title" content="Cocos y pyglet en modo interactivo" />
<meta property="og:description" content="Python tiene una herramienta super interesante para los nuevos programadores..." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.examplelab.com.ar/posts/2010-06-30-cocos-y-pyglet-en-modo-interactivo/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2010-06-30T15:00:00+00:00" />
<meta property="article:modified_time" content="2010-06-30T15:00:00+00:00" /><meta property="og:site_name" content="Examplelab" />







  </head>
  <body class="">
    <script>
      procesar_theme();
    </script>

    <div class="container">
      <header class="header">
  <span class="header__inner measure-2">
    <a href="/" class="logo" style="text-decoration: none;">
  <img width="64" height="64" src="/logo.png" alt="Logo" />
  <span class="logo__text pl2"> examplelab</span>
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about/index.html">Acerca de</a></li>
        
      
        
          <li><a href="/posts/index.html">Artículos</a></li>
        
      
        
          <li><a href="/links/index.html">Links</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about/index.html">Acerca de</a></li>
      
    
      
        <li><a href="/posts/index.html">Artículos</a></li>
      
    
      
        <li><a href="/links/index.html">Links</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger hidden">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        

  <div id="preview" role="button" class="dn no-user-select pointer overflow-auto vh-100 vw-100 bg-black-50 fixed z-max absolute--fill items-center justify-center">
    <div id="preview-content">
      <img src="/images/2021/la-culpa-no-es-del-dom/diff.png">
    </div>
  </div>


  <div class="post">
    <h2 class="post-title"><a href="https://www.examplelab.com.ar/posts/2010-06-30-cocos-y-pyglet-en-modo-interactivo/">Cocos y pyglet en modo interactivo</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
            30/06/2010
        </span>
      
      
      
    </div>

    
      <span class="post-tags">
        
          #<a href="https://www.examplelab.com.ar/tags/python/">python</a>&nbsp;
        
          #<a href="https://www.examplelab.com.ar/tags/interprete/">interprete</a>&nbsp;
        
          #<a href="https://www.examplelab.com.ar/tags/pyglet/">pyglet</a>&nbsp;
        
          #<a href="https://www.examplelab.com.ar/tags/cocos2d/">cocos2d</a>&nbsp;
        
      </span>
    

    <div class="post-content">
      <p>Python tiene una herramienta super interesante para los nuevos programadores: una consola interactiva donde se puede editar, corregir y ejecutar código de manera super sencilla.</p>
<p>Esto resulta de mucha utilidad cuando quieres dar clases sobre programación o simplemente dar una demostración sobre alguna biblioteca.</p>
<h2 id="introducción">Introducción</h2>
<p>Lamentablemente la consola de python no se puede usar en cualquier escenario, por ejemplo si quieres dar una demostración de la biblioteca <a href="http://cocos2d.org/">cocos2d</a> desde la consola interactiva se te pueden presentar algunos problemas.</p>
<p>Mediante este artículo intentaré encontrarle una solución a este problema, y en el camino veremos
Una aclaración inicial</p>
<p>Por cierto, <a href="http://cocos2d.org/">cocos2d</a> viene con una consola interactiva que se activa con las teclas <code>&lt;CTRL+I&gt;</code>.</p>
<p>Esa consola se ve dentro de la misma ventana de la aplicación y te permite hacer casi todo lo que veremos aquí.</p>
<p>La diferencia entre esa consola, y la que vamos a tratar de implementar aquí es la siguiente: en este artículo busco intergrar la consola de python tradicional, donde se puede copiar, pegar y autocompletar código.</p>
<h2 id="un-prototipo-de-ejemplo-para-descargar">Un prototipo de ejemplo para descargar</h2>
<p>La solución que veremos en este artículo me ha servido para realizar un prototipo de ejemplo.</p>
<p>Si quieres ir viendo el programa en funcionamiento lo puedes descargar de la siguiente dirección:</p>
<ul>
<li><a href="http://examplelab.googlecode.com/hg/interactive_cocos/interactive_cocos.py">http://examplelab.googlecode.com/hg/interactive_cocos/interactive_cocos.py</a></li>
</ul>
<p>donde la imagen que utilizo para representar el objeto animado principal está aquí:</p>
<p><img src="/images/2013/Oct/cara.png" alt=""></p>
<h2 id="cómo-se-utiliza-el-prototipo-de-consola">¿Cómo se utiliza el prototipo de consola?</h2>
<p>Primero tienes que descargar el script de la aplicación y ejecutarlo con el siguiente comando:</p>
<pre><code>python interactive_cocos2d.py
</code></pre>
<p>Luego, se abrirá una pantalla con un sprite que podrás manipular:</p>
<p><img src="/images/2013/Oct/screen_cara.png" alt=""></p>
<p>Por ejemplo, dentro de la consola python tiene dos referencias iniciales: cocos y sprite. Hagamos algo con ellas:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">sprite<span style="color:#f92672">.</span>rotate <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>
</code></pre></div><p>obteniendo:</p>
<p><img src="/images/2013/Oct/rotate.png" alt=""></p>
<p>Esto es útil para mostrar que el objeto en cuestión tiene atributos, y que se pueden manipular de manera sencilla.</p>
<p>También puedes ejecutar sentencias como <code>help(cocos)</code> o similares.</p>
<p>Ahora bien, con este escenario resulta mas interesante hablar sobre una de las características mas lindas que tiene <a href="http://cocos2d.org/">cocos2d</a>, el submódulo actions:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">media_vuelta <span style="color:#f92672">=</span> cocos<span style="color:#f92672">.</span>actions<span style="color:#f92672">.</span>RotateBy(<span style="color:#ae81ff">180</span>, <span style="color:#ae81ff">2</span>)
giro_completo <span style="color:#f92672">=</span> media_vuelta <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>

sprite<span style="color:#f92672">.</span>do(giro_completo)
</code></pre></div><p>Eso mostrará una animación de rotación completa en 4 segundos. Y como ninguna acción detiene nuesta consola de python, podemos incluso seguir escribiendo mienstras se ejecuta la acción.</p>
<h2 id="cómo-funciona">¿Cómo funciona?</h2>
<p>A continuación veremos paso a paso la implementación del prototipo que se utiliza mas arriba.</p>
<h2 id="objetivo">Objetivo</h2>
<p>Quisieramos ejecutar nuestro intérprete de python tradicional en primer plano, y que la ventana de la biblioteca <a href="http://cocos2d.org/">cocos2d</a> permanezca en segundo plano.</p>
<p>Esto nos facilitaría jugar con la biblioteca, conocer sus funciones y manipular sprites de manera interactiva.
Un primer paso: ¿usamos hilos?</p>
<p>Como queremos poner en funcionamiento una ventana de <a href="http://cocos2d.org/">cocos2d</a> y al mismo tiempo tener un intérprete, podríamos usar dos hilos: Uno para el interprete que recibe los comandos del usuario y otro para la biblioteca <a href="http://cocos2d.org/">cocos2d</a>.</p>
<h2 id="el-problema-hilos-y-opengl">El problema: Hilos y OpenGL</h2>
<p>Lo malo de este enfoque es que opengl (la biblioteca base debajo de <a href="http://cocos2d.org/">cocos2d</a>) define un contexto y espera que todas las llamadas de opengl se hagan desde el mismo hilo que ha creado el contexto. Y esto es un problema, porque en realidad para nuestro escenario lo ideal sería manipular opengl desde un hilo (la consola) y ver los cambios en otro hilo (el de cocos).</p>
<p>Entonces, al parecer tenemos como restricción que todo lo que actúa directamente sobre opengl tiene que ejecutarse dentro del mismo hilo que utiliza cocos.</p>
<h2 id="el-modelo-propuesto">El modelo propuesto</h2>
<p>Podemos tener dos hilos en ejecución, y una cola de mensajes que permite derivar todo el código a ejecutar dentro del hilo de cocos.</p>
<p>Este es un gráfico de la solución propuesta:</p>
<p><img src="/images/2013/Oct/esquema.png" alt=""></p>
<h2 id="creando-un-prototipo">Creando un prototipo</h2>
<p>El programa principal solamente tiene que poner en funcionamiento a los tres componentes juntos:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Cola de mensajes que se utiliza para llevar comandos al hilo.</span>
queue <span style="color:#f92672">=</span> Queue<span style="color:#f92672">.</span>Queue()

<span style="color:#75715e"># Hilo que ejecuta la funcionalidad de cocos.</span>
app <span style="color:#f92672">=</span> Application(queue)
app<span style="color:#f92672">.</span>start()

<span style="color:#75715e"># Interprete de comandos que envia todas las lineas que se escriben</span>
<span style="color:#75715e"># directamente a la cola de mensajes que consume el hilo.</span>
cmd <span style="color:#f92672">=</span> CommandLine(app, queue)
cmd<span style="color:#f92672">.</span>cmdloop()
</code></pre></div><p>Donde queue es la cola que se utiliza para enviar o delegar todas las cadena de texto que ingresa el usuario.</p>
<h2 id="el-intérprete">El intérprete</h2>
<p>Para crear el intérprete que acepta los comandos del usuario he utilizado la clase Cmd del módulo cmd:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CommandLine</span>(cmd<span style="color:#f92672">.</span>Cmd):

    <span style="color:#66d9ef">def</span> __init__(self, app, queue):
        cmd<span style="color:#f92672">.</span>Cmd<span style="color:#f92672">.</span>__init__(self, <span style="color:#e6db74">&#39;TAB&#39;</span>)
        self<span style="color:#f92672">.</span>queue <span style="color:#f92672">=</span> queue
        self<span style="color:#f92672">.</span>app <span style="color:#f92672">=</span> app
        self<span style="color:#f92672">.</span>prompt <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&gt;&gt;&gt; &#34;</span>

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">default</span>(self, line):
        <span style="color:#e6db74">&#34;Cualquier sentencia la envia a la cola de comandos que consume cocos.&#34;</span>
        self<span style="color:#f92672">.</span>queue<span style="color:#f92672">.</span>put(line)

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">do_exit</span>(self, line):
        self<span style="color:#f92672">.</span>app<span style="color:#f92672">.</span>kill()
        sys<span style="color:#f92672">.</span>exit(<span style="color:#ae81ff">0</span>)
</code></pre></div><p>La clase Cmd permite crear un intérprete de comandos parecido al original de python, incluido el autocompletado con la tecla TAB.</p>
<h2 id="hilo-de-cocos">Hilo de cocos</h2>
<p>El hilo que muestra la ventana de <a href="http://cocos2d.org/">cocos2d</a> solo tiene que mantener una ventana de la biblioteca visible y actualizar con frecuencia el contexto que ejecuta comandos:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span>(threading<span style="color:#f92672">.</span>Thread):

    <span style="color:#66d9ef">def</span> __init__(self, queue):
        threading<span style="color:#f92672">.</span>Thread<span style="color:#f92672">.</span>__init__(self)
        self<span style="color:#f92672">.</span>killed <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
        self<span style="color:#f92672">.</span>queue <span style="color:#f92672">=</span> queue

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run</span>(self):
        cocos<span style="color:#f92672">.</span>director<span style="color:#f92672">.</span>director<span style="color:#f92672">.</span>init(resizable<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>, width<span style="color:#f92672">=</span><span style="color:#ae81ff">800</span>, height<span style="color:#f92672">=</span><span style="color:#ae81ff">600</span>)
        self<span style="color:#f92672">.</span>scene <span style="color:#f92672">=</span> cocos<span style="color:#f92672">.</span>scene<span style="color:#f92672">.</span>Scene(cocos<span style="color:#f92672">.</span>layer<span style="color:#f92672">.</span>ColorLayer(<span style="color:#ae81ff">240</span>, <span style="color:#ae81ff">240</span>, <span style="color:#ae81ff">240</span>, <span style="color:#ae81ff">255</span>))
        sprite <span style="color:#f92672">=</span> cocos<span style="color:#f92672">.</span>sprite<span style="color:#f92672">.</span>Sprite(<span style="color:#e6db74">&#39;cara.png&#39;</span>)
        sprite<span style="color:#f92672">.</span>scale <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
        sprite<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> <span style="color:#ae81ff">400</span>
        sprite<span style="color:#f92672">.</span>y <span style="color:#f92672">=</span> <span style="color:#ae81ff">300</span>
        self<span style="color:#f92672">.</span>scene<span style="color:#f92672">.</span>add(sprite)

        <span style="color:#75715e"># Genera el entorno de la session, y le pasa datos que puede</span>
        <span style="color:#75715e"># manipular.</span>
        self<span style="color:#f92672">.</span>environment <span style="color:#f92672">=</span> environment(queue, sprite)
        self<span style="color:#f92672">.</span>environment<span style="color:#f92672">.</span>next()

        self<span style="color:#f92672">.</span>scene<span style="color:#f92672">.</span>schedule_interval(self<span style="color:#f92672">.</span>environment_update, <span style="color:#ae81ff">0.01</span>)
        cocos<span style="color:#f92672">.</span>director<span style="color:#f92672">.</span>director<span style="color:#f92672">.</span>run(self<span style="color:#f92672">.</span>scene)

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">environment_update</span>(self, dt):
        <span style="color:#e6db74">&#34;Mantiene en funcionamiento.&#34;</span>
        self<span style="color:#f92672">.</span>environment<span style="color:#f92672">.</span>next()

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">kill</span>(self):
        self<span style="color:#f92672">.</span>killed <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
        pyglet<span style="color:#f92672">.</span>app<span style="color:#f92672">.</span>exit()
</code></pre></div><h2 id="un-entorno-donde-viven-las-referencias">Un entorno donde viven las referencias</h2>
<p>La parte mas importante del sistema es la que se encarga de ejecutar el código que escribimos en consola.</p>
<p>Para ello he creado un generador, que conoce la cola de donde lee los mensajes que escribimos y los pone en funcionamiento.</p>
<p>Y dado que se trata de un generador, todo lo que se ejecuta dentro de él se mantiene en la memoria local, representando de alguna manera el contexto o espacio de nombres que buscamos conservar.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">environment</span>(queue, sprite):
    <span style="color:#e6db74">&#34;&#34;&#34;Representa la session y las variables locales de la instancia interactiva.
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    Este entorno funciona como un generador, con la intension de guardar
</span><span style="color:#e6db74">    el estado de todas las variables locales y acceder a los comandos desde
</span><span style="color:#e6db74">    la cola.&#34;&#34;&#34;</span>

    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:

        <span style="color:#66d9ef">try</span>:
            last <span style="color:#f92672">=</span> queue<span style="color:#f92672">.</span>get_nowait()

            <span style="color:#66d9ef">if</span> last:
                <span style="color:#66d9ef">try</span>:
                    exec(last)
                <span style="color:#66d9ef">except</span>:
                    print <span style="color:#e6db74">&#34;Error al ejecutar&#34;</span>, last

        <span style="color:#66d9ef">except</span> Queue<span style="color:#f92672">.</span>Empty:
            <span style="color:#66d9ef">pass</span>

        <span style="color:#66d9ef">yield</span> <span style="color:#66d9ef">None</span>
</code></pre></div><p>Nota: Un enfoque similar usan las aplicaciones REPL, donde incluso existe la funcionalidad de reiniciar el contexto cuando hemos hecho algo mal.</p>
<h2 id="conclusión">Conclusión</h2>
<p>Python ofrece una gran flexibilidad, y si bien creo que la solución al problema planteado se puede mejorar, actualmente puede ser de utilidad para otras personas.</p>
<p>Personalmente, lo encuentro útil para explicar algunos conceptos de programación mediante un enfoque práctico. Ideas como abstracción, encapsulación o polimorfismo quedan mas claras si se las puede reflejar con un ejemplo visible.</p>

    </div>

    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h">Leer otros artículos</span>
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="https://www.examplelab.com.ar/posts/2010-07-22-creando-int%C3%A9rpretes-interactivos-con-python/">
                  <span class="button__icon">←</span>
                  <span class="button__text">Creando intérpretes interactivos con python</span>
                </a>
              </span>
            
            
          </div>
        </div>
      
    


    
      
        

      
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  <img width="64" height="64" src="/logo.png" alt="Logo" />
  <span class="logo__text pl2"> examplelab</span>
</a>

      <div class="copyright">
        <span>© 2010-2024 Hugo Ruscitti</span>
      </div>
    
  </div>
</footer>


<script src="https://www.examplelab.com.ar/assets/prism.js"></script>


      
    </div>
  </body>
</html>
